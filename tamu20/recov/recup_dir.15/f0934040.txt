ground-color: Window;
	font: 8pt;
}

table
{
	border-style: none;
	border-width: 0;
	margin: 0;
}

a
{
	text-decoration: none;
}

a:hover
{
	text-decoration: underline;
}

a:active
{
	text-decoration: underline;
}

.SecOOBEHeaderRow
{
	background-color: #666F74;
}

.SecOOBEHeaderDiv
{
	overflow: hidden; 
	width: 100%; 
}

.SecOOBEBodyDiv
{
	width: 100%; 
	overflow: auto;
	padding-left: 30px; 
	padding-right: 30px; 
	padding-top: 10px; 
	padding-bottom: 10px;
}

.SecOOBEAlertText
{
	font-family: Tahoma;
	color: #000000;
	font-weight: bold;
	font-size: 13px;
}

.SecOOBEActionText
{
	font-family: Tahoma;
	color: #0066CC;
	font-weight: bold;
	font-size: 13px;
}

.SecOOBEFinishText
{
	font: messagebox;
	color: WindowText;
}

.SCWLink
{
	font: messagebox; 
	color: blue;   
}

.SecOOBEConfirmWindow
{
	background-color: ButtonFace;
	color: WindowText;
	margin: 10px;
	border: 0;
	font: messagebox;
}

.SecOOBEConfirmText
{
	color: ButtonText;
	font: messagebox;	
}

.SecOOBEConfirmButton
{
	color: ButtonText;
	font: messagebox;	
	width: 80px;
}

.SecOOBEButton
{
	color: ButtonText;
	font: messagebox;
	width: 80px;
}

.SecOOBEStepTitle
{
	font-family: Tahoma;
	font-weight: bold;
	font-size: 18px;
	color: #666F74;
}

.SecOOBEStepText
{
	color: WindowText;
	font: messagebox;
}

.SecOOBEMoreInfo
{
	color: WindowText;
	font: messagebox;
}

.SecOOBECPLLink a
{
	color: blue;
	font: messagebox;
	text-decoration: underline;
}

.SecOOBECPLLink a:hover
{
	color: blue;
	font: messagebox;
	text-decoration: underline;
}

.SecOOBECPLLink a:active
{
	color: blue;
	font: messagebox;
	text-decoration: underline;
}

.SecOOBELogoSpan
{
	width: 68px;
}

.SecOOBETitle
{
	color: #FFFFFF;
	font-size: 22px;
	font-family: Tahoma;
	margin-left: 15px;
	margin-right: 15px;
}

.SecOOBEBodyTable
{
	width: 100%;
	height: 100%;
	vertical-align: top;
}	

.SecOOBEHeaderTable
{
	width: 100%;
	vertical-align: top;
	border: 1px solid #BFCDCF;
}	

PAD<html>
<head>
	<meta name=vs_targetSchema content="http://schemas.microsoft.com/intellisense/ie5">
	<meta HTTP-EQUIV="MSThemeCompatible" CONTENT="Yes">
	<link rel="stylesheet" type="text/css" href="SecOOBE.css"></link>
</head>

    <script language="jscript" >
        var DefWindowWidth = 780;
        var DefWindowHeight = 600;
        var E_ACCESSDENIED = -2146828218;
        var ERROR_SERVICE_NOT_ACTIVE = -2147023834;

        var LEFT   = 0;
        var TOP    = 1;
        var WIDTH  = 2;
        var HEIGHT = 3;

		// LOAD THE SUPPORT COM OBJECT
		var oSec = new ActiveXObject("SecOOBE.SecurityChecklistHelper");
		
		// LOAD THE XML and XSL files
		var msxmlControl = "Msxml2.DOMDocument.3.0";
	    
		var xmlOOBE = new ActiveXObject(msxmlControl);
		xmlOOBE.load("SecOOBE.xml");
		// DO RUNTIME CUSTOMIZATION OF STEPS & ACTIONS
		updateXML(xmlOOBE);

		var xslOOBE = new ActiveXObject(msxmlControl);
		xslOOBE.load("SecOOBE.xsl");
		

        function minInt( x, y )
        {
            if (x < y)
            {
                return x;
            }
            else
            {
                return y;
            }
        }

        function maxInt( x, y )
        {
            if (x > y)
            {
                return x;
            }
            else
            {
                return y;
            }
        }

		function executeAction(actionID)
		{
			try
			{
				oSec.DoAction(actionID);
			}
			catch(ex)
			{
				var message = xmlOOBE.selectSingleNode("/SecOOBE/errorDoAction/@text").value;
				alert(message);	
			}
		}
		
        function executeCmd(cmdString)
        {
            try
            {
				var shellObj = new ActiveXObject("WScript.Shell");
    			shellObj.Run(cmdString);
            }
            catch(ex)
            {
                var message = xmlStatic.selectSingleNode("/SecOOBE/errorDoAction/@text").value;
                alert(message);
            }
		}
		
        function executeChm(cmdString)
        {
            executeCmd('"%SystemRoot%\\hh.exe" ' + cmdString);
        }
		
		function executeCpl(cmdString)
		{
            execCmd('"%SystemRoot%\\system32\\control.exe" ' + cmdString);
		}
		
		function updateXML(oXML)
		{
			if (oXML == null)
				return;
			
			// Get and enumerate the steps
			var nodeSteps = oXML.selectNodes("/SecOOBE/stepList/step");
			var i;
			for (i=0; i < nodeSteps.length; i++)
			{
				customizeStep(nodeSteps[i]);
			}			
		}
		
		function customizeStep(nodeStep)
		{
			switch(nodeStep.getAttribute("stepID"))
			{
				case "1":
					// Add customization for stepID=1
					// Use this code to enum the step's actions:
					//     var nodeActions = nodeStep.selectNodes("action");

					break;
				case "2":
					// Add customization for stepID=2
					var bIsAUConfigured = false;
					try 
					{
					    bIsAUConfigured = oSec.IsAutoUpdateConfigured();
					}
					catch ( ex )
					{
					    bIsAUConfigured = false;					
					}
					
					if (bIsAUConfigured)
					{
						nodeStep.setAttribute("description", nodeStep.getAttribute("description_alt"));
						var nodeActions = nodeStep.selectNodes("action");
						var i=0;
						for (i=0; i < nodeActions.length; i++)
						{
							nodeActions[i].setAttribute("visible", "0");
						}
					}
					break;
			}
		}
			
        function sizeMainWindow()
        {
            var area;

            try
            {
                var area_string = oSec.GetWorkingAreaInfo();
                area = area_string.split(",");

                if (area.length != 4)
                {
                    throw "Unexpected info format.";   
                }
            }
            catch(ex)
            {
                // Fall back to best guess.
                area = new Array(4);
                area[LEFT]   = 0;
                area[TOP]    = 0;
                area[WIDTH]  = screen.availWidth;
                area[HEIGHT] = screen.availHeight;
            }

            var w = minInt(area[WIDTH], DefWindowWidth);
            var h = minInt(area[HEIGHT], DefWindowHeight);

            window.resizeTo(w, h);

            // Center in middle of available area.
            // Need  " - 0 " to avoid string concatenation.
            var left = (area[WIDTH] - w)/2 + (area[LEFT] - 0);
            var top  = (area[HEIGHT] - h)/2 + (area[TOP] - 0);

            window.moveTo(left, top);
        }

        sizeMainWindow();
        
    </script>
    
	<script language="jscript" event="onload" for="window">

        // SET THE DOCUMENT TITLE
        document.title = xmlOOBE.selectSingleNode("/SecOOBE/@title").value;

		// RENDER THE XSL
		divMain.innerHTML = xmlOOBE.transformNode(xslOOBE);

		divBody.style.posHeight = document.body.clientHeight - divHeader.offsetHeight;

        document.getElementById("buttonFinish").focus();
        
    </script>
    
    <script language="jscript" event="onresize" for="window">

		divBody.style.posHeight = document.body.clientHeight - divHeader.offsetHeight;
        
    </script>

    <script language="jscript" event="onclick" for="buttonFinish">
		
		function confirmOptions()
		{
			var message;
			var title;
			var yesText;
			var noText;
			var yesAccessKey;
			var noAccessKey;
		}
		
		function dialogOptions()
		{
			var message;
			var CPLPrefixText;
			var CPLLinkText;
			var CPLSuffixText;
			var OKText;
			var title;
			var errorText;
		}
		
		function showConfirm()
		{
			var dlgOptions = new confirmOptions();
			var confirmDialog = xmlOOBE.selectSingleNode("/SecOOBE/confirmDialog");
			
			dlgOptions.message = confirmDialog.getAttribute("text");
			dlgOptions.title = confirmDialog.getAttribute("title");
			dlgOptions.yesText = confirmDialog.getAttribute("yesText");
			dlgOptions.noText = confirmDialog.getAttribute("noText");
			dlgOptions.yesAccessKey = confirmDialog.getAttribute("yesAccessKey");
			dlgOptions.noAccessKey = confirmDialog.getAttribute("noAccessKey");

			var width = confirmDialog.getAttribute("dialogWidth");
			var height = confirmDialog.getAttribute("dialogHeight");
			
			return window.showModalDialog("confirm.htm", dlgOptions, "dialogHeight: " + height + "px; dialogWidth: " + width + "px; center: yes; resizable: no; help: no; scrollbars: no; status: no;");
		}
		
		function showAlert(message, dlgHeight, cplPrefix, cplText, cplSuffix)
		{
			var dlgOptions = new dialogOptions();
			var errorDialog = xmlOOBE.selectSingleNode("/SecOOBE/errorDialog");
			
			dlgOptions.title = errorDialog.getAttribute("title");
			dlgOptions.message = message;
			dlgOptions.OKText = errorDialog.getAttribute("OKText");
			dlgOptions.CancelText = errorDialog.getAttribute("CancelText");
			dlgOptions.CPLPrefixText = cplPrefix;
			dlgOptions.CPLLinkText = cplText;
			dlgOptions.CPLSuffixText = cplSuffix;
			dlgOptions.errorText = xmlOOBE.selectSingleNode("/SecOOBE/errorDoAction/@text").value;
			
			var width = errorDialog.getAttribute("dialogWidth");
			var height = dlgHeight;

			return window.showModalDialog("error.htm", dlgOptions, "dialogHeight: " + height + "px; dialogWidth: " + width + "px; center: yes; resizable: no; help: no; scrollbars: no; status: no;");
		}

		// If the firewall was disabled before Finish was clicked, notify the user.
		var bFwEnabled = false;
		var bFwServiceOffButAutomatic = false;
		try 
		{
		    bFwEnabled = oSec.IsFireWallEnabledByDefault();
		}
		catch (ex)
		{
		    bFwEnabled = false;
		    if (ex.number == ERROR_SERVICE_NOT_ACTIVE)
		    {
		        bFwServiceOffButAutomatic = true;
		    }
		}
		if (!bFwEnabled)
		{
		    if (bFwServiceOffButAutomatic)
		    {
			    var message = xmlOOBE.selectSingleNode("/SecOOBE/errorServiceNotRunning/@text").value;
			    var dlgHeight = xmlOOBE.selectSingleNode("/SecOOBE/errorServiceNotRunning/@dialogHeight").value;
			    var prefixText = xmlOOBE.selectSingleNode("/SecOOBE/errorServiceNotRunning/@CPLPrefixText").value;
			    var linkText = xmlOOBE.selectSingleNode("/SecOOBE/errorServiceNotRunning/@CPLLinkText").value;
			    var suffixText = xmlOOBE.selectSingleNode("/SecOOBE/errorServiceNotRunning/@CPLSuffixText").value;
			    if ( showAlert(message, dlgHeight, prefixText, linkText, suffixText) )
                {
			        window.close();
			    }
			    return;		    
		    }
		    else
		    {
			    var message = xmlOOBE.selectSingleNode("/SecOOBE/errorFirewallChanged/@text").value;
			    var dlgHeight = xmlOOBE.selectSingleNode("/SecOOBE/errorFirewallChanged/@dialogHeight").value;
			    var prefixText = xmlOOBE.selectSingleNode("/SecOOBE/errorFirewallChanged/@CPLPrefixText").value;
			    var linkText = xmlOOBE.selectSingleNode("/SecOOBE/errorFirewallChanged/@CPLLinkText").value;
			    var suffixText = xmlOOBE.selectSingleNode("/SecOOBE/errorFirewallChanged/@CPLSuffixText").value;
			    if ( showAlert(message, dlgHeight, prefixText, linkText, suffixText) )
                {
                    try 
                    {
			            oSec.FinishOOBE();
			        }
			        catch (ex)
			        {
			        }        			    
			        window.close();
			    }
			    return;
		    }
		}
		
		// Tell the user that the Firewall will be disabled now.
		if (showConfirm())
		{
			try
			{
				oSec.DisableFirewall();
			}
			catch(ex)
			{
				var message;
				var dlgHeight;
			    var prefixText;
			    var linkText;
			    var suffixText;
				
				if (ex.number == E_ACCESSDENIED)	// Insufficient rights to disable the firewall
				{
					message = xmlOOBE.selectSingleNode("/SecOOBE/errorDisableFirewallNoRights/@text").value;
					dlgHeight = xmlOOBE.selectSingleNode("/SecOOBE/errorDisableFirewallNoRights/@dialogHeight").value;
			        var prefixText = xmlOOBE.selectSingleNode("/SecOOBE/errorDisableFirewallNoRights/@CPLPrefixText").value;
			        var linkText = xmlOOBE.selectSingleNode("/SecOOBE/errorDisableFirewallNoRights/@CPLLinkText").value;
			        var suffixText = xmlOOBE.selectSingleNode("/SecOOBE/errorDisableFirewallNoRights/@CPLSuffixText").value;					
				}
				else
				{
					message = xmlOOBE.selectSingleNode("/SecOOBE/errorDisableFirewall/@text").value;
					dlgHeight = xmlOOBE.selectSingleNode("/SecOOBE/errorDisableFirewall/@dialogHeight").value;
			        var prefixText = xmlOOBE.selectSingleNode("/SecOOBE/errorDisableFirewall/@CPLPrefixText").value;
			        var linkText = xmlOOBE.selectSingleNode("/SecOOBE/errorDisableFirewall/@CPLLinkText").value;
			        var suffixText = xmlOOBE.selectSingleNode("/SecOOBE/errorDisableFirewall/@CPLSuffixText").value;					
				}
				// On error, alert the user but don't finish OOBE
				if(showAlert(message, dlgHeight, prefixText, linkText, suffixText))
				{
				    // if the user clicked OK then close UI
				    window.close();
				}
				return;
			}
			
			try
			{
			    oSec.FinishOOBE();
			}
			catch ( ex )
			{
			}
			window.close();
		}
		
    </script>
    
        <HTA:APPLICATION 
            APPLICATIONNAME="SecOOBE" 
            BORDER="thick"
            CAPTION="no"
            SHOWINTASKBAR="yes"
            SINGLEINSTANCE="yes"
            SYSMENU="yes"
            WINDOWSTATE="normal"
            SELECTION="no"
            SCROLL="no"
            NAVIGABLE="yes"
            ICON="ico_server.ico"
        />

	<body>
		<div id="divMain"></div>
	</body>
</html>
<?xml version="1.0"?>
<!--loc: keep the inline html markup below to mark the access key -->
<SecOOBE title="Sicherheitsupdatekonfiguration für Windows Server">
	<_locDefinition>
            <_locTag _loc="locData" _locAttrData="*">SecOOBE</_locTag>
            <_locTag _loc="locData" _locAttrData="text">alertInfo</_locTag>
            <_locTag _loc="locData" _locAttrData="*">finishInfo</_locTag>
            <_locTag _loc="locData" _locAttrData="*">errorDoAction</_locTag>
            <_locTag _loc="locData" _locAttrData="*">errorDisableFirewall</_locTag>
            <_locTag _loc="locData" _locAttrData="*">errorDisableFirewallNoRights</_locTag>
            <_locTag _loc="locData" _locAttrData="*">errorFirewallChanged</_locTag>
            <_locTag _loc="locData" _locAttrData="*">errorServiceNotRunning</_locTag>
            <_locTag _loc="locData" _locAttrData="*">confirmDialog</_locTag>
            <_locTag _loc="locData" _locAttrData="*">errorDialog</_locTag>
            <_locTag _loc="locData" _locAttrData="title,description,description_alt,moreInfoAccessKey,moreInfoText,moreInfoToolTip">step</_locTag>
            <_locTag _loc="locData" _locAttrData="title,accessKey,actionToolTip">action</_locTag>
	</_locDefinition>
	<alertInfo text="Zum Schutz des Servers werden alle eingehenden Verbindungen geblockt, soweit sie nicht explizit während der Installation oder durch Richtlinieneinstellungen geöffnet wurden. Sie sollten die folgenden Schritte sofort durchführen."/>
	<finishInfo text="Klicken Sie auf &quot;Fertig stellen&quot;, um diese Seite zu schließen und eingehende Verbindungen mit diesem Server zuzulassen. Weitere Informationen über eingehende Verbindungen erhalten Sie in der " SCWLink="Hilfe des Sicherheitskonfigurations-Assistenten." button="&lt;u&gt;F&lt;/u&gt;ertig stellen" accessKey="F"/>
	<errorDoAction text="Die angeforderte Datei bzw. Seite wurde nicht gefunden. Drücken Sie F5, um die Seite für die Sicherheitsupdatekonfiguration für Windows Server zu aktualisieren und klicken Sie erneut auf den Link."/>
	<errorDisableFirewall text="Die Einstellungen zum Zulassen eingehender Verbindungen konnten nicht geändert werden. Wenn Sie auf &quot;OK&quot; klicken, werden keine 