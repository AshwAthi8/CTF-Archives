<HTML XMLNS:helpcenter>
<HEAD>
<!--
Copyright (c) 2000 Microsoft Corporation
-->
<TITLE>Remote Assistance</TITLE>
<meta http-equiv="MSThemeCompatible" content="Yes">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<LINK id="UI_StyleSheet" REL="stylesheet" TYPE="text/css" HREF="../../Css/rc.css">
<LINK ID=Stylesheet_Ref4 href="hcp://system/css/shared.css" rel=STYLESHEET type=text/css>
<SCRIPT LANGUAGE="Javascript" EVENT="onCommand( tb, id )" FOR="idTB">
switch ( id ) {
case "btnTakeControl":
case "btnReleaseControl":
Helper_TakeControl();
break;
case "btnSendFile_1":
Helper_LaunchFileXfer( 0 );
break;
case "btnVoice":
case "btnVoiceStop":
Helper_SendVoice();
break;
case "btnOptions":
Helper_HandleOptions();
break;
case "btnQuit_1":
Helper_QuitMethod();
break;
case "btnHelp":
Help();
break;
}
</SCRIPT>
<script LANGUAGE="Javascript" >
var g_oSAFRemoteAssistanceHelper = null;
var oSAFClassFactory = parent.oSAFClassFactory;
var g_bTakeControlDisabled = false;
var L_STOPTALKING_Text = "&nbsp;&nbsp;Stop <U>T</U>alking";
var L_STARTTALKING_Text = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Start <u>T</u>alking";
var L_ERRRCTOGGLEFAILED_Text = "The 'Take Control' feature is not responding. Please try again or restart the session.";
var L_WAITINGFOR_Text = "Requesting control...";
var L_TORESPOND_Text = " to respond to the remote control request.";
var L_ERRVOIP2_Text = "The necessary hardware and/or configuration to use a voice connection is not available;'Start Talking' will be disabled for the remainder of this Remote Assistance session.";
function ShowVoiceHelp()
{
var oShell = new ActiveXObject("WScript.Shell");
var oFSO = new ActiveXObject("Scripting.FileSystemObject");
var vArgs = new Array(2);
vArgs[0] = oShell;
vArgs[1] = oFSO;
ret=window.showModalDialog("..\\common\\VoiceFirewallmsg.htm",vArgs,"DialogWidth:405px;DialogHeight:168px;Status:no;scroll:no");
}
function DisableToolbar()
{
;
try
{
try
{
idTB.SetState( "btnTakeControl", false );
}
catch(error)
{
}
try
{
idTB.SetState( "btnReleaseControl", false );
}
catch(error)
{
}
idTB.SetState( "btnSendFile_1", false );
try
{
idTB.SetState( "btnVoice", false );
}
catch(error)
{
}
try
{
idTB.SetState( "btnVoiceStop", false );
}
catch(error)
{
}
idTB.SetState( "btnOptions", false );
idTB.SetState( "btnQuit_1", false );
}
catch(error)
{
parent.FatalError( parent.L_RCCTL_Text, error );
}
;
}
function DoLoad()
{
var L_ERRACCESSDENIED_Text = "Directly launching this page is not allowed. ";
if(null==parent.idFrameSet1)
{
idBody.style.visibility = "hidden";
alert( L_ERRACCESSDENIED_Text );
return;
}
idTB.Mode = 1;
idTB.SetVisibility("btnVoice", false);
}
function Helper_InitializeTools()
{
;
try
{
;
idTB.SetState( "btnVoice", true );
if (parent.g_oSAFRemoteAssistanceHelper != null)
{
g_oSAFRemoteAssistanceHelper = parent.g_oSAFRemoteAssistanceHelper;
}
parent.Helper_SetupControlChannel();
g_oSAFRemoteAssistanceHelper.m_bConnected = true;
g_oSAFRemoteAssistanceHelper.m_oSAFRemoteDesktopClient.ConnectRemoteDesktop();
if(true == parent.g_bVoIPEnabled )
{
g_oSAFRemoteAssistanceHelper.m_oSAFIntercomClient = oSAFClassFactory.CreateObject_IntercomClient();
if( null == g_oSAFRemoteAssistanceHelper.m_oSAFIntercomClient )
{
parent.FatalError(parent.L_RCCTL_Text);
}
g_oSAFRemoteAssistanceHelper.m_oSAFIntercomClient.onVoiceDisconnected = Helper_onVoiceDisconnected;
g_oSAFRemoteAssistanceHelper.m_oSAFIntercomClient.onVoiceConnected = Helper_onVoiceConnected;
g_oSAFRemoteAssistanceHelper.m_oSAFIntercomClient.onVoiceDisabled = Helper_onVoiceDisabled;
}
}
catch(error)
{
parent.FatalError( parent.L_RCCTL_Text, error );
}
;
return;
}
function Helper_TakeControl()
{
;
try
{
if( parent.frames.idFrameScreen.g_oSAFRemoteAssistanceHelper.m_bConnected == false )
{
;
return;
}
if(null != g_oSAFRemoteAssistanceHelper.m_oSAFRemoteDesktopClient)
{
if( (false == g_oSAFRemoteAssistanceHelper.m_bRCEnabled )&& (false == g_bTakeControlDisabled))
{
parent.Helper_SendControlCommand( "REMOTECTRLSTART" );
idTB.SetState( "btnTakeControl", false );
g_bTakeControlDisabled = true;
var sMsg = L_WAITINGFOR_Text;
parent.frames.idFrameStatus.Helper_UpdateStatus( sMsg );
idTB.SetState( "btnReleaseControl", true );
}
else
{
idTB.SetVisibility( "btnTakeControl", true);
idTB.SetState( "btnTakeControl", true );
idTB.SetVisibility( "btnReleaseControl", false);
g_oSAFRemoteAssistanceHelper.m_bRCEnabled = false;
g_bTakeControlDisabled = false;
parent.Helper_ResetHelpee();
try
{
var oLogger = new ActiveXObject("RACplDlg.RAEventLog");
var args = new Array(2);
args[0] = g_oSAFRemoteAssistanceHelper.m_szLocalUser;
args[1] = g_oSAFRemoteAssistanceHelper.m_szUserName;
oLogger.LogRemoteAssistanceEvent(0,6,args);
}
catch(e)
{
}
parent.frames.idFrameStatus.Helper_UpdateStatus( parent.L_SCREENVIEWONLY_Text );
}
}
}
catch(error)
{
parent.FatalError( L_ERRRCTOGGLEFAILED_Text, error );
}
;
return;
}
function Helper_LaunchFileXfer( mode )
{
;
var vArgs = new Array(11);
try
{
if( parent.frames.idFrameScreen.g_oSAFRemoteAssistanceHelper.m_bConnected == false )
{
;
return;
}
vArgs[0] = mode;
vArgs[1] = g_oSAFRemoteAssistanceHelper.m_oControlChannel;
vArgs[2] = g_oSAFRemoteAssistanceHelper.m_oSAFRemoteDesktopChannelMgr;
vArgs[3] = g_oSAFRemoteAssistanceHelper.m_iChannelId;
vArgs[4] = g_oSAFRemoteAssistanceHelper.m_oFso;
vArgs[5] = g_oSAFRemoteAssistanceHelper.m_oSAFClassFactory;
vArgs[6] = g_oSAFRemoteAssistanceHelper.m_szUserName;
vArgs[7] = new ActiveXObject("SAFRCFileDlg.FileOpen");
vArgs[8] = g_oSAFRemoteAssistanceHelper.m_szLocalUser;
vArgs[9] = parent.frames.idFrameScreen.g_oSAFRemoteAssistanceHelper.m_szHelpeeIP;
vArgs[10] = new ActiveXObject("RACplDlg.RAEventLog");
var subWin = window.showModelessDialog( "hcp://system/Remote Assistance/Interaction/Common/RCFileXfer.htm", vArgs, "dialogwidth:" + "405" + "px;dialogHeight:" + "179" + "px;status:no;resizable:no;help:no");
parent.AddOpenSubWin( subWin );
}
catch(error)
{
parent.FatalError( parent.L_RCCTL_Text, error );
}
;
return;
}
function Helper_QuitMethod()
{
if(null==parent.idFrameSet1)
{
return;
}
;
try
{
if( false == parent.g_ExpertDisconnected )
{
parent.g_ExpertDisconnected = true;
}
if ((null != g_oSAFRemoteAssistanceHelper) && (null != g_oSAFRemoteAssistanceHelper.m_oSAFIntercomClient))
{
try
{
;
g_oSAFRemoteAssistanceHelper.m_oSAFIntercomClient.Exit();
;
}
catch(error)
{
;
}
}
if( parent.frames.idFrameScreen.g_oSAFRemoteAssistanceHelper.m_bConnected == false )
{
if( null != parent.oSAFClassFactory )
{
parent.oSAFClassFactory.Close();
}
;
return;
}
;
idBody.disabled = true;
parent.frames.idFrameStatus.btnActual.disabled=true;
parent.frames.idFrameStatus.btnScale.disabled=true;
parent.frames.idFrameStatus.Helper_UpdateStatus( parent.L_DISCONNECTION_Text );
;
parent.RCDisconnect();
}
catch(error)
{
parent.FatalError( parent.L_RCCTL_Text, error );
}
return;
}
function Helper_SendVoice()
{
;
try
{
if(false == parent.g_bVoIPEnabled )
{
;
return;
}
if( parent.frames.idFrameScreen.g_oSAFRemoteAssistanceHelper.m_bConnected == false )
{
;
return;
}
if(parent.g_StartTalking == 1)
{
try
{
var oICFAllowList = oSAFClassFactory.CreateObject_ICFAllowList();
oICFAllowList.Add();
}
catch(error)
{
}
parent.g_StartTalking = 0;
var bShielded = true;
bShielded = !(CanOpenPort("\\pchealth\\helpctr\\binaries\\helpctr.exe", 0));
if (bShielded)
{
parent.g_StartTalking = 1;
ShowVoiceHelp();
return;
}
}
else
{
parent.g_StartTalking = 1;
}
idTB.SetState( "btnVoice", false );
parent.g_bStartEnabled = false;
parent.Helper_SendControlCommand( "PRESTART" );
}
catch(error)
{
parent.FatalError( parent.L_RCCTL_Text, error );
}
;
return;
}
function Helper_HandleOptions()
{
;
try
{
if( parent.frames.idFrameScreen.g_oSAFRemoteAssistanceHelper.m_bConnected == false )
{
;
return;
}
var obj=new ActiveXObject( "SAFRCFileDlg.RASetting" );
var vArgs=new Array(3);
vArgs[0]=parent;
vArgs[1]=obj;
vArgs[2]="";
var ret=window.showModalDialog("Setting.htm",vArgs,"dialogWidth:405px;dialogHeight:330px;dialogTop:200px;dialogLeft:400px;edge:raised;status:no;help:no;");
}
catch(error)
{
parent.FatalError( parent.L_RCCTL_Text, error );
}
;
return;
}
function Helper_onVoiceDisconnected()
{
;
try
{
if (true == g_oSAFRemoteAssistanceHelper.m_bConnected)
{
parent.g_bVoipConnected = false;
parent.g_StartTalking = 1;
if (parent.g_bVoIPEnabled == true)
{
idTB.SetVisibility( "btnVoice", true );
idTB.SetState( "btnVoice", true );
idTB.SetVisibility( "btnVoiceStop", false );
}
parent.g_bStartEnabled = true;
}
}
catch (error)
{
parent.FatalError( parent.L_RCCTL_Text, error );
}
;
}
function Helper_onVoiceConnected()
{
;
try
{
parent.g_bVoipConnected = true;
parent.g_bStartEnabled = true;
idTB.SetVisibility( "btnVoice", false );
idTB.SetVisibility( "btnVoiceStop", true );
idTB.SetState( "btnVoiceStop", true );
}
catch (error)
{
parent.FatalError( parent.L_RCCTL_Text, error );
}
;
}
function Helper_onVoiceDisabled()
{
;
try
{
if (parent.g_bVoIPEnabled == true)
{
parent.g_bVoIPEnabled = false;
parent.g_bVoipConnected = false;
parent.DisplayMessage( L_ERRVOIP2_Text );
idTB.SetState( "btnVoice", false );
parent.g_stateVoipMe = 2;
parent.Helper_SendControlCommand( "DISABLEVOICE" );
}
}
catch(error)
{
parent.FatalError( parent.L_RCCTL_Text, error );
}
;
}
function Help()
{
;
try
{
parent.LaunchHelpEx(0);
}
catch( error )
{
parent.FatalError( parent.L_ERRFATAL_Text, error );
}
;
}
function document.onkeydown()
{
try
{
parent.iKeyCode[ parent.iKeyCnt ] = window.event.keyCode;
parent.iKeyCnt = (parent.iKeyCnt+1)%3;
switch( parent.iKeyCode[ parent.iKeyCnt ] ) {
case 0x8:
window.event.returnValue = false;
break;
}
}
catch(error)
{
SetFocus();
window.event.returnValue = false;
}
}
function SetFocus()
{
try
{
idTB.focus();
}
catch(error)
{
idBody.focus();
}
}
</script>
<script language="vbscript">
function CanOpenPort(AppName, PortNumber)
dim ShellObj
Set ShellObj = CreateObject("WScript.Shell")
AppName = ShellObj.ExpandEnvironmentStrings("%windir%") & AppName
dim FirewallManager
Set FirewallManager = CreateObject("HNetCfg.FwMgr")
dim NET_FW_IP_VERSION_ANY
NET_FW_IP_VERSION_ANY = 2
dim NET_FW_IP_PROTOCOL_TCP
NET_FW_IP_PROTOCOL_TCP = 6
dim IPAddress
dim AppAllowed, PortRestricted
AppAllowed = false
PortRestricted = false
FirewallManager.IsPortAllowed AppName, NET_FW_IP_VERSION_ANY, PortNumber, IPAddress, NET_FW_IP_PROTOCOL_TCP, AppAllowed, PortRestricted
if AppAllowed = True and PortRestricted = False then CanOpenPort = true else CanOpenPort = false
End Function
</script>
<STYLE>
.styRAToolBarTable
{
visibility:visible;
margin-Left:1mm;
margin-top:1mm;
margin-bottom:1mm;
Height:80%;
}
</STYLE>
</head>
<body id="idBody" onFocus="SetFocus()" onLoad="DoLoad()" tabindex=-1 onunload="Helper_QuitMethod()" scroll=no>
<OBJECT id="idTB" name="idTB" CLASSID="CLSID:FC7D9E08-3F9E-11d3-93C0-00C04F72DAF7" WIDTH=100% HEIGHT=100% >
<PARAM id=NoLoc1 name="Definition" value="RAToolbar.xml">
</OBJECT>
</body>
</html>